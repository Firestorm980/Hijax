!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function a(a,r){base=this,base.element=a,base.settings=t.extend({},n,r),base._defaults=n,base._name=e,base._init()}var e="hijax",n={container:"#siteContent",exclude:'[data-hijax="false"]',smoothScroll:!1,smoothScrollDuration:1e3,sequenceIn:function(t,a){console.log("in"),console.log(a.url.current+" | "+a.url.previous),t()},sequenceOut:function(t,a){console.log("out"),console.log(a.url.target+" | "+a.url.current),t()}};t.extend(a.prototype,{_init:function(){{var t=this;t.element}return t._check.supports?(t._data={url:{initial:null,previous:null,current:null,target:null},pop:{state:!1,id:history.state.id||0,direction:""},element:null,ajax:{loading:!1,request:null,response:null,target:"",success:!1}},void t._bindEvents.call(t)):(console.error("Hijax: History support not detected. Aborting."),!1)},_bindEvents:function(){var t=this;jQuery(document).on("click."+e,"a:not("+t.settings.exclude+")",function(a){t._eventSwitch.call(t,"click",a,this)}),jQuery(window).on("popstate."+e,function(a){t._eventSwitch.call(t,"popstate",a,this)}),jQuery(window).on("load."+e,function(){t._eventSwitch.call(t,"load")})},_eventSwitch:function(t,a,e){var n=this;switch(t){case"load":n._event.load.call(n);break;case"click":n._event.click.call(n,a,e);break;case"popstate":n._event.popstate.call(n,a,e);break;case"manual":n._event.manual.call(n)}},_check:{supports:function(){var t=navigator.userAgent;return-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone")?window.history&&"pushState"in window.history:!1},page:function(t,a){for(var e=t.split("/"),n=e[e.length-1],r=a.split("/"),i=r[r.length-1],o=e.length>r.length?e.length:r.length,l=-1,s=0,u=o;u>s;s++){var c=e[s]||null,d=r[s]||null;if(c!==d){l=s;break}}if(l>-1){if(l===o-1){var _=n.indexOf("#")>-1?n.substring(0,n.indexOf("#")):n,p=i.indexOf("#")>-1?i.substring(0,i.indexOf("#")):i;return _===p?!0:!1}return!1}return!0}},_event:{load:function(){var t=this,a=t._data;a.url.initial=window.location.href,a.url.current=window.location.href,null===history.state&&history.replaceState({url:a.url.initial,id:a.pop.id},document.title,a.url.initial)},click:function(t,a){var e=this,n=jQuery(a),r=n.attr("href"),i=n.prop("hash"),o=n[0].hasAttribute("download"),l=n.attr("target"),s="_blank"===l||"_parent"===l||"_top"===l?!1:!0,u=e._data.url.current,c=e._check.page.call(this,u,r);c?i.length||t.preventDefault():s&&!o&&(t.preventDefault(),e._data.element=a,e._data.url.previous=window.location.href,e._data.url.target=r,e._data.pop.state=!1,e._history.start_load.call(e))},popstate:function(t,a){var e=this,n=e._data.pop.id,r=history.state.id;e._data.element=a,e._data.url.previous=e._data.url.current,e._data.url.target=window.location.href,e._data.pop.state=!0,n>r?e._data.pop.direction="back":r>n&&(e._data.pop.direction="forward"),e._data.pop.id=history.state.id,e._history.start_load.call(e)},manual:function(){var t=this;t._data.element=window,t._data.url.previous=window.location.href,t._data.pop.state=!1,t._history.start_load.call(t)}},_history:{update:function(){var t=this,a=t._data;a.url.current=window.location.href,a.url.target=null},start_load:function(){var a=this,e=function(){a._history.load.call(a)},n=function(){a._data.ajax.loading?a._data.ajax.loading&&a._data.url.target!==a._data.ajax.target&&(null!==a._data.ajax.request&&a._data.ajax.request.abort(),a._data.ajax.loading=!0,a._data.ajax.target=a._data.url.target,jQuery.isFunction(a.settings.sequenceOut)?a.settings.sequenceOut.call(a._data.element,e,r):console.error('Hijax: Setting for "sequenceOut" is not a function. Aborting.')):(a._data.ajax.loading=!0,a._data.ajax.target=a._data.url.target,jQuery.isFunction(a.settings.sequenceOut)?a.settings.sequenceOut.call(a._data.element,e,r):console.error('Hijax: Setting for "sequenceOut" is not a function. Aborting.'))},r={url:{current:a._data.url.current,target:a._data.url.target},element:a._data.element};a._data.pop.state&&(r.direction=a._data.pop.direction),a.settings.smoothScroll?t("html,body").animate({scrollTop:0,scrollLeft:0},{duration:a.settings.smoothScrollDuration,complete:n}):(window.scrollTo(0,0),n())},load:function(){var a=this;a._data.ajax.target=a._data.url.target,null!==a._data.ajax.target&&(t(a.element).trigger({type:"progress.hijax",percent:0}),t(a.element).trigger("beforeload.hijax"),a._data.ajax.request=jQuery.ajax({url:a._data.ajax.target,type:"GET",dataType:"html",xhr:function(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var n=e.loaded/e.total*100;t(a.element).trigger({type:"progress.hijax",percent:n})}},!1),e}}).done(function(e){a._data.ajax.response=e,a._data.ajax.success=!0,t(a.element).trigger("afterload.hijax"),a._history.end_load.call(a)}).fail(function(){a._data.ajax.success=!1}).always(function(){}))},end_load:function(){var a=this,e=function(){a._data.ajax.loading=!1,t(a.element).trigger("completeload.hijax")},n=null;a._data.ajax.success&&(a._content.update_container.call(a),a._content.update_title.call(a)),a._data.pop.state||a._history.push.call(a),a._history.analytics.call(a),a._history.update.call(a),n={url:{current:a._data.url.current,previous:a._data.url.previous}},jQuery.isFunction(a.settings.sequenceIn)?a.settings.sequenceIn.call(this,e,n):console.error('Hijax: Setting for "sequenceIn" is not a function. Aborting.')},push:function(){var t=this,a=t._data.url.target,e=t._data.pop.id,n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?a+"#":a;history.pushState({url:a,id:e+1},document.title,n),t._data.pop.id=e+1},analytics:function(){var t=t||void 0;void 0!==t&&t("send","pageview")}},_content:{update_container:function(){var t=this,a=t.settings.container,e=t._data.ajax.response,n=jQuery.parseHTML(e),r=jQuery(n).find(a).html(),i=jQuery(a);i.html(r)},update_title:function(){var t=this,a=(t.settings.container,t._data.ajax.response),e=jQuery.parseHTML(a),n=jQuery(e).filter("title").html();document.title=n}},data:function(){var t=this;return t._data},response:function(){var t=this;return t._data.ajax.response},load:function(t){var a=this,e=a._data.url.current,n=a._check.page(e,t);"string"!=typeof url||n||(a._data.url.target=t,a._eventSwitch.call(a,"manual"))}}),t.fn[e]=function(n){var r=Array.prototype.slice.call(arguments,1),i=null;return this.each(function(){var o=t.data(this,"plugin_"+e);o?"string"==typeof n&&"_"!==n.charAt(0)&&t.isFunction(o[n])&&(i=o[n].apply(o,r)):t.data(this,"plugin_"+e,new a(this,n))}),null!==i?i:this}});
