!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,n){base=this,base.element=e,base.settings=t.extend({},r,n),base._defaults=r,base._name=a,base._init()}var a="hijax",r={container:"#siteContent",exclude:'[data-hijax="false"]',scrollToTop:!1,scrollToHash:!1,smoothScroll:!1,smoothScrollDuration:1e3,smoothScrollContainer:"",sequenceIn:function(t){t()},sequenceOut:function(t){t()}};t.extend(e.prototype,{_init:function(){var t=this;t.element;return t._check.supports?(t._scroller=null,t.settings.smoothScroll&&t._check.scroller.call(t),t._data={url:{initial:null,previous:null,current:null,target:null},pop:{state:!1,id:null!==history.state?history.state.id:0,direction:""},element:null,ajax:{loading:!1,request:null,response:null,target:"",success:!1}},void t._bindEvents.call(t)):(console.error("Hijax: History support not detected. Aborting."),!1)},_bindEvents:function(){var t=this;jQuery(document).on("click."+a,"a:not("+t.settings.exclude+")",function(e){t._eventSwitch.call(t,"click",e,this)}),jQuery(window).on("popstate."+a,function(e){t._eventSwitch.call(t,"popstate",e,this)}),jQuery(window).on("load."+a,function(){t._eventSwitch.call(t,"load")})},_eventSwitch:function(t,e,a){var r=this;switch(t){case"load":r._event.load.call(r);break;case"click":r._event.click.call(r,e,a);break;case"popstate":r._event.popstate.call(r,e,a);break;case"manual":r._event.manual.call(r)}},_check:{scroller:function(){var t=this,e=0,a=0,r=jQuery(t.settings.smoothScrollContainer);r.length?t._scroller=t.settings.smoothScrollContainer:(window.scrollTo(0,1),e=document.documentElement.scrollTop,a=document.body.scrollTop,1===e?t._scroller="html":1===a&&(t._scroller="body"),window.scrollTo(0,0))},supports:function(){var t=navigator.userAgent;return-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone")?window.history&&"pushState"in window.history:!1},page:function(t,e){var a=t.split("/"),r=a[a.length-1],n="",o=e.split("/"),i=o[o.length-1],l="",s=a.length>o.length?a.length:o.length,u=-1;if("#"===o[0])return!0;for(var c=0,d=s;d>c;c++){var p=a[c]||null,_=o[c]||null;if(p!==_){u=c;break}}return u>-1?u===s-1?(n=r.indexOf("#")>-1?r.substring(0,r.indexOf("#")):r,l=i.indexOf("#")>-1?i.substring(0,i.indexOf("#")):i,n===l?!0:!1):!1:!0},domain:function(t){var e=document.createElement("a");return e.href=t,e.hostname===location.hostname}},_event:{load:function(){var t=this,e=t._data;e.url.initial=window.location.href,e.url.current=window.location.href,null===history.state&&history.replaceState({url:e.url.initial,id:e.pop.id},document.title,e.url.initial)},click:function(t,e){var a=this,r=a._data;if($elem=jQuery(e),target_url=$elem.attr("href"),target_hash=$elem.prop("hash"),target_download=$elem[0].hasAttribute("download"),target_target=$elem.attr("target"),target_state="_blank"===target_target||"_parent"===target_target||"_top"===target_target?!1:!0,current_url=a._data.url.current,is_same_page=a._check.page.call(this,current_url,target_url),is_same_domain=a._check.domain.call(this,target_url),is_same_domain)if(is_same_page)if(target_hash.length){if(!a.settings.scrollToHash)return;var n=jQuery(target_hash).offset().top;t.preventDefault(),jQuery(a._scroller).stop(!0,!0).animate({scrollTop:n},a.settings.smoothScrollDuration),history.pushState({url:r.url.current,id:r.pop.id+1},document.title,target_hash)}else t.preventDefault(),$elem.trigger({type:"samelocation.hijax"});else target_state&&!target_download&&(t.preventDefault(),a._data.element=e,a._data.url.previous=window.location.href,a._data.url.target=target_url,a._data.pop.state=!1,a._history.start_load.call(a))},popstate:function(t,e){var a=this,r=a._data.pop.id,n=history.state.id,o=a._check.page.call(a,a._data.url.current,window.location.href);o||(a._data.element=e,a._data.url.previous=a._data.url.current,a._data.url.target=window.location.href,a._data.pop.state=!0,r>n?a._data.pop.direction="back":n>r&&(a._data.pop.direction="forward"),a._data.pop.id=history.state.id,a._history.start_load.call(a))},manual:function(){var t=this;t._data.element=window,t._data.url.previous=window.location.href,t._data.pop.state=!1,t._history.start_load.call(t)}},_history:{update:function(){var t=this,e=t._data;e.url.current=window.location.href,e.url.target=null},start_load:function(){var t=this,e=function(){t._history.load.call(t)},a=function(){t._data.ajax.loading?t._data.ajax.loading&&t._data.url.target!==t._data.ajax.target&&(null!==t._data.ajax.request&&t._data.ajax.request.abort(),t._data.ajax.loading=!0,t._data.ajax.target=t._data.url.target,jQuery.isFunction(t.settings.sequenceOut)?t.settings.sequenceOut.call(t._data.element,e,r):console.error('Hijax: Setting for "sequenceOut" is not a function. Aborting.')):(t._data.ajax.loading=!0,t._data.ajax.target=t._data.url.target,jQuery.isFunction(t.settings.sequenceOut)?t.settings.sequenceOut.call(t._data.element,e,r):console.error('Hijax: Setting for "sequenceOut" is not a function. Aborting.'))},r={url:{current:t._data.url.current,target:t._data.url.target},element:t._data.element};t._data.pop.state&&(r.direction=t._data.pop.direction),!t.settings.smoothScroll&&t.settings.scrollToTop||t._data.pop.state&&t.settings.scrollToTop?(jQuery(t._scroller).scrollTop(0),a()):t.settings.smoothScroll&&jQuery(t._scroller).scrollTop()>0&&t.settings.scrollToTop?jQuery(t._scroller).stop(!0,!0).animate({scrollTop:0,scrollLeft:0},{duration:t.settings.smoothScrollDuration,complete:a}):a()},load:function(){var e=this;e._data.ajax.target=e._data.url.target,null!==e._data.ajax.target&&(t(e.element).trigger({type:"beforeload.hijax"}),t(e.element).trigger({type:"progress.hijax",percent:0}),e._data.ajax.request=jQuery.ajax({url:e._data.ajax.target,type:"GET",dataType:"html",xhr:function(){var a=new window.XMLHttpRequest;return a.addEventListener("progress",function(a){if(a.lengthComputable){var r=a.loaded/a.total*100;t(e.element).trigger({type:"progress.hijax",percent:r})}},!1),a}}).done(function(t){e._data.ajax.response=t,e._data.ajax.success=!0,jQuery(e.element).trigger({type:"afterload.hijax",response:t}),e._history.end_load.call(e)}).fail(function(t){var a=t.status,r=t.statusText,n=e._data.url.previous,o=e._data.pop.id,i=navigator.userAgent.match(/iPhone|iPad|iPod/i)?n+"#":n;e._data.ajax.success=!1,e._data.pop.state&&history.replaceState({url:n,id:o},document.title,i),jQuery(e.element).trigger({type:"errorload.hijax",status:a,statusText:r})}))},end_load:function(){var e=this,a=function(){var a=window.location.hash;e._data.ajax.loading=!1,e.settings.scrollToHash&&""!==a&&jQuery(a).length?jQuery(e._scroller).stop(!0,!0).animate({scrollTop:jQuery(a).offset().top},{duration:e.settings.smoothScrollDuration,complete:function(){t(e.element).trigger({type:"completeload.hijax"})}}):t(e.element).trigger({type:"completeload.hijax"})},r=null;e._data.ajax.success&&(e._content.update_container.call(e),e._content.update_title.call(e)),e._data.pop.state||e._history.push.call(e),e._history.analytics.call(e),e._history.update.call(e),r={url:{current:e._data.url.current,previous:e._data.url.previous}},jQuery.isFunction(e.settings.sequenceIn)?e.settings.sequenceIn.call(this,a,r):console.error('Hijax: Setting for "sequenceIn" is not a function. Aborting.')},push:function(){var t=this,e=t._data.url.target,a=t._data.pop.id,r=navigator.userAgent.match(/iPhone|iPad|iPod/i)?e+"#":e;history.pushState({url:e,id:a+1},document.title,r),t._data.pop.id=a+1},analytics:function(){var t=t||void 0;void 0!==t&&t("send","pageview")}},_content:{update_container:function(){var t=this,e=t.settings.container,a=t._data.ajax.response,r=jQuery.parseHTML(a),n=jQuery(e),o=jQuery("<div>").append(r).find(e),i=o.html();n.html(i)},update_title:function(){var t=this,e=(t.settings.container,t._data.ajax.response),a=jQuery.parseHTML(e),r=jQuery(a).filter("title").html();document.title=r}},response:function(){var t=this;return t._data.ajax.response},load:function(t){var e=this,a=e._data.url.current,r=e._check.page(a,t),n=e._check.domain.call(this,t);"string"==typeof t&&!r&&n?(e._data.url.target=t,e._eventSwitch.call(e,"manual")):n||(window.location.href=t)}}),t.fn[a]=function(r){var n=Array.prototype.slice.call(arguments,1),o=null;return this.each(function(){var i=t.data(this,"plugin_"+a);i?"string"==typeof r&&"_"!==r.charAt(0)&&t.isFunction(i[r])&&(o=i[r].apply(i,n)):t.data(this,"plugin_"+a,new e(this,r))}),null!==o?o:this}});
//# sourceMappingURL=jquery.hijax.min.js.map