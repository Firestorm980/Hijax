!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(t,n){base=this,base.element=t,base.settings=e.extend({},o,n),base._defaults=o,base._name=a,base._init()}var a="hijax",o={container:"#siteContent",exclude:'[data-hijax="false"]',scrollToTop:!1,scrollToHash:!1,smoothScroll:!1,smoothScrollDuration:1e3,smoothScrollContainer:"",googleAnalytics:"ga",sequenceIn:function(e){e()},sequenceOut:function(e){e()}};e.extend(t.prototype,{_init:function(){var e=this;e.element;return e._check.supports?(e._scroller=null,e.settings.smoothScroll&&e._check.scroller.call(e),e._data={url:{initial:null,previous:null,current:null,target:null},pop:{state:!1,id:null!==history.state?history.state.id:0,direction:""},element:null,ajax:{loading:!1,request:null,response:null,target:"",success:!1}},void e._bindEvents.call(e)):(console.error("Hijax: History support not detected. Aborting."),!1)},_bindEvents:function(){var e=this;jQuery(document).on("click."+a,"a:not("+e.settings.exclude+")",function(t){e._eventSwitch.call(e,"click",t,this)}),jQuery(window).on("popstate."+a,function(t){e._eventSwitch.call(e,"popstate",t,this)}),jQuery(window).on("load."+a,function(){e._eventSwitch.call(e,"load")})},_eventSwitch:function(e,t,a){var o=this;switch(e){case"load":o._event.load.call(o);break;case"click":o._event.click.call(o,t,a);break;case"popstate":o._event.popstate.call(o,t,a);break;case"manual":o._event.manual.call(o)}},_check:{scroller:function(){var e=this,t=0,a=0,o=jQuery(e.settings.smoothScrollContainer);o.length?e._scroller=e.settings.smoothScrollContainer:(window.scrollTo(0,1),t=document.documentElement.scrollTop,a=document.body.scrollTop,1===t?e._scroller="html":1===a&&(e._scroller="body"),window.scrollTo(0,0))},supports:function(){var e=navigator.userAgent;return-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone")?window.history&&"pushState"in window.history:!1},page:function(e,t){var a=e.split("/"),o=a[a.length-1],n="",i=t.split("/"),r=i[i.length-1],s="",l=a.length>i.length?a.length:i.length,c=-1;if("#"===i[0])return!0;for(var u=0,d=l;d>u;u++){var p=a[u]||null,h=i[u]||null;if(p!==h){c=u;break}}return c>-1?c===l-1?(n=o.indexOf("#")>-1?o.substring(0,o.indexOf("#")):o,s=r.indexOf("#")>-1?r.substring(0,r.indexOf("#")):r,n===s?!0:!1):!1:!0},domain:function(e){var t=document.createElement("a");return t.href=e,t.hostname===location.hostname}},_event:{load:function(){var e=this,t=e._data;t.url.initial=window.location.href,t.url.current=window.location.href,null===history.state&&history.replaceState({url:t.url.initial,id:t.pop.id},document.title,t.url.initial)},click:function(e,t){var a=this,o=a._data;if($elem=jQuery(t),target_url=$elem.attr("href"),target_hash=$elem.prop("hash"),target_download=$elem[0].hasAttribute("download"),target_target=$elem.attr("target"),target_state="_blank"===target_target||"_parent"===target_target||"_top"===target_target?!1:!0,current_url=a._data.url.current,is_same_page=a._check.page.call(this,current_url,target_url),is_same_domain=a._check.domain.call(this,target_url),is_same_domain)if(is_same_page)if(target_hash.length){if(!a.settings.scrollToHash)return;var n=jQuery(target_hash).offset().top;e.preventDefault(),jQuery(a._scroller).stop(!0,!0).animate({scrollTop:n},a.settings.smoothScrollDuration),history.pushState({url:o.url.current,id:o.pop.id+1},document.title,target_hash)}else e.preventDefault(),$elem.trigger({type:"samelocation.hijax"});else target_state&&!target_download&&(e.preventDefault(),a._data.element=t,a._data.url.previous=window.location.href,a._data.url.target=target_url,a._data.pop.state=!1,a._history.start_load.call(a))},popstate:function(e,t){var a=this,o=a._data.pop.id,n=history.state.id,i=a._check.page.call(a,a._data.url.current,window.location.href);i||(a._data.element=t,a._data.url.previous=a._data.url.current,a._data.url.target=window.location.href,a._data.pop.state=!0,o>n?a._data.pop.direction="back":n>o&&(a._data.pop.direction="forward"),a._data.pop.id=history.state.id,a._history.start_load.call(a))},manual:function(){var e=this;e._data.element=window,e._data.url.previous=window.location.href,e._data.pop.state=!1,e._history.start_load.call(e)}},_history:{update:function(){var e=this,t=e._data;t.url.current=window.location.href,t.url.target=null},start_load:function(){var e=this,t=function(){e._history.load.call(e)},a=function(){e._data.ajax.loading?e._data.ajax.loading&&e._data.url.target!==e._data.ajax.target&&(null!==e._data.ajax.request&&e._data.ajax.request.abort(),e._data.ajax.loading=!0,e._data.ajax.target=e._data.url.target,jQuery.isFunction(e.settings.sequenceOut)?e.settings.sequenceOut.call(e._data.element,t,o):console.error('Hijax: Setting for "sequenceOut" is not a function. Aborting.')):(e._data.ajax.loading=!0,e._data.ajax.target=e._data.url.target,jQuery.isFunction(e.settings.sequenceOut)?e.settings.sequenceOut.call(e._data.element,t,o):console.error('Hijax: Setting for "sequenceOut" is not a function. Aborting.'))},o={url:{current:e._data.url.current,target:e._data.url.target},element:e._data.element};e._data.pop.state&&(o.direction=e._data.pop.direction),!e.settings.smoothScroll&&e.settings.scrollToTop||e._data.pop.state&&e.settings.scrollToTop?(jQuery(e._scroller).scrollTop(0),a()):e.settings.smoothScroll&&jQuery(e._scroller).scrollTop()>0&&e.settings.scrollToTop?jQuery(e._scroller).stop(!0,!0).animate({scrollTop:0,scrollLeft:0},{duration:e.settings.smoothScrollDuration,complete:a}):a()},load:function(){var t=this;t._data.ajax.target=t._data.url.target,null!==t._data.ajax.target&&(e(t.element).trigger({type:"beforeload.hijax"}),e(t.element).trigger({type:"progress.hijax",percent:0}),t._data.ajax.request=jQuery.ajax({url:t._data.ajax.target,type:"GET",dataType:"html",xhr:function(){var a=new window.XMLHttpRequest;return a.addEventListener("progress",function(a){if(a.lengthComputable){var o=a.loaded/a.total*100;e(t.element).trigger({type:"progress.hijax",percent:o})}},!1),a}}).done(function(e){t._data.ajax.response=e,t._data.ajax.success=!0,jQuery(t.element).trigger({type:"afterload.hijax",response:e}),t._history.end_load.call(t)}).fail(function(e){var a=e.status,o=e.statusText,n=t._data.url.previous,i=t._data.pop.id,r=navigator.userAgent.match(/iPhone|iPad|iPod/i)?n+"#":n;t._data.ajax.success=!1,t._data.pop.state&&history.replaceState({url:n,id:i},document.title,r),jQuery(t.element).trigger({type:"errorload.hijax",status:a,statusText:o})}))},end_load:function(){var t=this,a=function(){var a=window.location.hash;t._data.ajax.loading=!1,t.settings.scrollToHash&&""!==a&&jQuery(a).length?jQuery(t._scroller).stop(!0,!0).animate({scrollTop:jQuery(a).offset().top},{duration:t.settings.smoothScrollDuration,complete:function(){e(t.element).trigger({type:"completeload.hijax"})}}):e(t.element).trigger({type:"completeload.hijax"})},o=null;t._data.ajax.success&&(t._content.update_container.call(t),t._content.update_title.call(t)),t._data.pop.state||t._history.push.call(t),t._history.analytics.call(t),t._history.update.call(t),o={url:{current:t._data.url.current,previous:t._data.url.previous}},jQuery.isFunction(t.settings.sequenceIn)?t.settings.sequenceIn.call(this,a,o):console.error('Hijax: Setting for "sequenceIn" is not a function. Aborting.')},push:function(){var e=this,t=e._data.url.target,a=e._data.pop.id,o=navigator.userAgent.match(/iPhone|iPad|iPod/i)?t+"#":t;history.pushState({url:t,id:a+1},document.title,o),e._data.pop.id=a+1},analytics:function(){var e=this,t=e.settings.googleAnalytics,a=window[t]||void 0;void 0!==a&&a.call(this,"send","pageview",{page:location.pathname,title:document.title})}},_content:{update_container:function(){var e=this,t=e.settings.container,a=e._data.ajax.response,o=jQuery.parseHTML(a),n=jQuery(t),i=jQuery("<div>").append(o).find(t),r=i.html();n.html(r)},update_title:function(){var e=this,t=(e.settings.container,e._data.ajax.response),a=jQuery.parseHTML(t),o=jQuery(a).filter("title").html();document.title=o}},response:function(){var e=this;return e._data.ajax.response},load:function(e){var t=this,a=t._data.url.current,o=t._check.page(a,e),n=t._check.domain.call(this,e);"string"==typeof e&&!o&&n?(t._data.url.target=e,t._eventSwitch.call(t,"manual")):n||(window.location.href=e)}}),e.fn[a]=function(o){var n=Array.prototype.slice.call(arguments,1),i=null;return this.each(function(){var r=e.data(this,"plugin_"+a);r?"string"==typeof o&&"_"!==o.charAt(0)&&e.isFunction(r[o])&&(i=r[o].apply(r,n)):e.data(this,"plugin_"+a,new t(this,o))}),null!==i?i:this}});
//# sourceMappingURL=jquery.hijax.min.js.map