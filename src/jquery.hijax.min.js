!function(t){var e={element:"#hijax-content",exclude:'[data-hijax="false"]',loadingClass:"hijax-loading",metaClass:"hijax-meta",whitelist:["php","html","htm",""],smoothScroll:!0,smoothScrollDuration:750,sequenceOut:function(t){t()},sequenceIn:function(t){t()},beforeLoad:function(){},afterLoad:function(){},loadComplete:function(){}};t.Hijax=function(n){var o,a,i=t.extend({},e,n),l=!1,r=location.href,c=0,u=null,d=!1,s=r,f={init:function(){window.history&&history.pushState&&(t(document).on("click","a:not("+i.exclude+")",f.linkClick),t(window).on("popstate",f.windowPop))},checkSamePage:function(t,e){var n=t.split("/"),o=n[n.length-1],a=e.split("/"),i=a[a.length-1],l=n.length>a.length?n.length:a.length;pathDifferenceIndex=-1;for(var r=0,c=l;c>r;r++){var u=n[r]||null,d=a[r]||null;if(u!==d){pathDifferenceIndex=r;break}}if(pathDifferenceIndex>-1){if(pathDifferenceIndex===l-1){var s=o.indexOf("#")>-1?o.substring(0,o.indexOf("#")):o,f=i.indexOf("#")>-1?i.substring(0,i.indexOf("#")):i;return s===f?!0:!1}return!1}return!0},linkClick:function(e){var n=window.location,o=t(this).attr("target")||!1,l="_blank"===o||"_parent"===o||"_top"===o?!1:!0,r=t(this).attr("href"),c=t(this).prop("hash"),u=r.split("/"),d=u[u.length-1],s=d.substr((~-d.lastIndexOf(".")>>>0)+2),h=i.whitelist,p=f.checkSamePage(n.href,r);p?c.length||e.preventDefault():h.indexOf(s)>-1&&l&&(e.preventDefault(),a=e.target,f.loadResource(r,!0))},ajaxRequest:function(e,n){c++;var o=c;u=t.ajax({type:"GET",url:e,dataType:"html",xhr:function(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var n=e.loaded/e.total*100;t(document).trigger({type:"hijax.progress",percent:n})}},!1),e}}),t(document).trigger({type:"hijax.progress",percent:0}),f.windowScroll(0),u.done(function(a){var l=i.element,r=jQuery.parseHTML(a),u=t(r).find(l).html();o==c&&(t(l).html(u),typeof i.afterLoad==typeof Function&&i.afterLoad(),f.changeMeta(r),f.changeHistory(e,n),f.loadComplete())})},loadResource:function(e,n){var l=function(){f.ajaxRequest(e,n)};d?(null!==u&&u.abort(),f.ajaxRequest(e,n)):(d=!0,o=!1,typeof i.beforeLoad==typeof Function&&i.beforeLoad(),t("html").addClass(i.loadingClass),typeof i.sequenceOut==typeof Function&&i.sequenceOut(l,a))},loadComplete:function(){var e=function(){var e=window.location.hash;typeof i.loadComplete==typeof Function&&i.loadComplete(),t("html").removeClass(i.loadingClass),d=!1,s=window.location.href,e.length&&f.windowScroll(t(e).offset().top)};typeof i.sequenceIn==typeof Function&&i.sequenceIn(e)},changeMeta:function(e){var n=t(e).filter("title").html(),o=t("."+i.metaClass);o.length&&o.each(function(){var e=t(this),n=e.attr("data-tag"),o=e.attr("data-type"),a=e.attr("data-"+o),i=e.attr("data-content");"title"===n?document.title=i:t("head meta["+o+'="'+a+'"]').attr("content",i)}),t("."+i.metaClass+'[data-tag="title"]').length||(document.title=n)},changeHistory:function(t,e){var n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?t+"#":t,o=document.title,a=a||void 0;e&&(history.pushState({url:t},o,n),l=!0),void 0!==a&&a("send","pageview")},windowPop:function(t){var e=!l&&location.href==r;if(l=!0,!e){{var n=f.checkSamePage(s,window.location.href);window.location.hash}n||(o=!1,a=t.target,f.loadResource(window.location,!1))}},windowScroll:function(e){return i.smoothScroll?(t("html, body").animate({scrollTop:e},i.smoothScrollDuration),!1):void window.scrollTo(0,e)}};return f.init(),{load:function(t){var e=checkSamePage(s,t);"string"!=typeof t||e||(a=null,f.loadResource(t,!0))}}}}(jQuery);
