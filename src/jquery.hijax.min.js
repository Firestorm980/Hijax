!function(e){var t={element:"#hijax-content",exclude:'[data-hijax="false"]',loadingClass:"hijax-loading",metaClass:"hijax-meta",whitelist:["php","html","htm",""],sequenceOut:function(e){e()},sequenceIn:function(e){e()},beforeLoad:function(){},afterLoad:function(){},loadComplete:function(){}};e.Hijax=function(n){var o,a,i=e.extend({},t,n),l=!1,r=location.href,c=0,s=!1,d=r,f={init:function(){window.history&&history.pushState&&(e(document).on("click","a:not("+i.exclude+")",f.linkClick),e(window).on("popstate",f.windowPop))},checkSamePage:function(e,t){var n=e.split("/"),o=n[n.length-1],a=t.split("/"),i=a[a.length-1],l=n.length>a.length?n.length:a.length;pathDifferenceIndex=-1;for(var r=0,c=l;c>r;r++){var s=n[r]||null,d=a[r]||null;if(s!==d){pathDifferenceIndex=r;break}}if(pathDifferenceIndex>-1){if(pathDifferenceIndex===l-1){var f=o.indexOf("#")>-1?o.substring(0,o.indexOf("#")):o,u=i.indexOf("#")>-1?i.substring(0,i.indexOf("#")):i;return f===u?!0:!1}return!1}return!0},linkClick:function(t){var n=window.location,o=e(this).attr("target")||!1,a="_blank"===o||"_parent"===o||"_top"===o?!1:!0,l=e(this).attr("href"),r=e(this).prop("hash"),c=l.split("/"),s=c[c.length-1],d=s.substr((~-s.lastIndexOf(".")>>>0)+2),u=i.whitelist,h=f.checkSamePage(n.href,l);h?(t.preventDefault(),r.length&&(window.scrollTo(0,e(r).offset().top),window.location.hash=r)):u.indexOf(d)>-1&&a&&(t.preventDefault(),f.loadResource(l,!0))},ajaxRequest:function(t,n){c++;var o=c;console.log(o),a=e.ajax({type:"GET",url:t,dataType:"html",xhr:function(){var t=new window.XMLHttpRequest;return t.addEventListener("progress",function(t){if(t.lengthComputable){var n=t.loaded/t.total*100;e(document).trigger({type:"hijax.progress",percent:n})}},!1),t}}),e(document).trigger({type:"hijax.progress",percent:0}),window.scrollTo(0,0),a.done(function(a){var l=i.element,r=jQuery.parseHTML(a),s=e(r).find(l).html();console.log(c),o==c&&(e(l).html(s),typeof i.afterLoad==typeof Function&&i.afterLoad(),f.changeMeta(r),f.changeHistory(t,n),f.loadComplete())})},loadResource:function(t,n){s?(a.abort(),a=null,f.ajaxRequest(t,n)):(s=!0,o=!1,typeof i.beforeLoad==typeof Function&&i.beforeLoad(),e("html").addClass(i.loadingClass),typeof i.sequenceOut==typeof Function&&i.sequenceOut(function(){f.ajaxRequest(t,n)}))},loadComplete:function(){var t=function(){typeof i.loadComplete==typeof Function&&i.loadComplete(),e("html").removeClass(i.loadingClass),s=!1,d=window.location.href};typeof i.sequenceIn==typeof Function&&i.sequenceIn(t)},changeMeta:function(t){var n=e(t).filter("title").html(),o=e("."+i.metaClass);o.length&&o.each(function(){var t=e(this),n=t.attr("data-tag"),o=t.attr("data-type"),a=t.attr("data-"+o),i=t.attr("data-content");"title"===n?document.title=i:e("head meta["+o+'="'+a+'"]').attr("content",i)}),e("."+i.metaClass+'[data-tag="title"]').length||(document.title=n)},changeHistory:function(e,t){var n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?e+"#":e,o=document.title,a=a||void 0;t&&(history.pushState({url:e},o,n),l=!0),void 0!==a&&a("send","pageview")},windowPop:function(){var t=!l&&location.href==r;if(l=!0,!t){var n=f.checkSamePage(d,window.location.href),a=window.location.hash;n?a.length&&window.scrollTo(0,e(a).offset().top):(o=!1,f.loadResource(window.location,!1))}}};return f.init(),{load:function(e){f.loadResource(e,!0)}}}}(jQuery);
