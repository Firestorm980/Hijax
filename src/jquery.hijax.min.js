!function(t){var e={element:"#hijax-content",exclude:'[data-hijax="false"]',loadingClass:"hijax-loading",metaClass:"hijax-meta",whitelist:["php","html","htm",""],sequenceOut:function(t){t()},sequenceIn:function(t){t()},beforeLoad:function(){},afterLoad:function(){},loadComplete:function(){}};t.Hijax=function(n){var a=t.extend({},e,n),o=!0,i={init:function(){window.history&&history.pushState&&(t(document).on("click","a:not("+a.exclude+")",i.linkClick),t(window).bind("popstate",i.windowPop))},linkClick:function(e){var n=t(this).attr("target")||!1,o="_blank"===n||"_parent"===n||"_top"===n?!1:!0,l=t(this).attr("href"),r=l.split("/"),u=""!==r[r.length-1]?r[r.length-1]:r[r.length-2],c=u.substr((~-u.lastIndexOf(".")>>>0)+2),d=window.location.pathname.split("/"),s=""!==d[d.length-1]?d[d.length-1]:d[d.length-2],f=a.whitelist;"#"!==l&&f.indexOf(c)>-1&&o&&u!==s?(e.preventDefault(),i.loadResource(l,!0)):u===s&&e.preventDefault()},ajaxRequest:function(e,n){var o=t.ajax({type:"GET",url:e,dataType:"html",xhr:function(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){if(e.lengthComputable){var n=e.loaded/e.total*100;t(document).trigger({type:"hijax.progress",percent:n})}},!1),e}});t(document).trigger({type:"hijax.progress",percent:0}),o.done(function(o){var l=a.element,r=jQuery.parseHTML(o),u=t(r).find(l).html();t(l).html(u),typeof a.afterLoad==typeof Function&&a.afterLoad(),i.changeMeta(r),i.changeHistory(e,n),window.scrollTo(0,0)}),o.complete(i.loadComplete)},loadResource:function(e,n){o=!1,typeof a.beforeLoad==typeof Function&&a.beforeLoad(),t("html").addClass(a.loadingClass),typeof a.sequenceOut==typeof Function&&a.sequenceOut(function(){i.ajaxRequest(e,n)})},loadComplete:function(){var e=function(){typeof a.loadComplete==typeof Function&&a.loadComplete(),t("html").removeClass(a.loadingClass)};typeof a.sequenceIn==typeof Function&&a.sequenceIn(e)},changeMeta:function(e){var n=t(e).filter("title").html(),o=t("."+a.metaClass);o.length&&o.each(function(){var e=t(this),n=e.attr("data-tag"),a=e.attr("data-type"),o=e.attr("data-"+a),i=e.attr("data-content");"title"===n?document.title=i:t("head meta["+a+'="'+o+'"]').attr("content",i)}),t("."+a.metaClass+'[data-tag="title"]').length||(document.title=n)},changeHistory:function(t,e){var n=navigator.userAgent.match(/iPhone|iPad|iPod/i)?t+"#":t,a=document.title,o=o||void 0;e&&history.pushState({url:t},a,n),void 0!==o&&o("send","pageview")},windowPop:function(t){null===t.originalEvent.state&&o||(o=!1,i.loadResource(window.location,!1))}};return i.init(),{load:function(t){i.loadResource(t,!0)}}}}(jQuery);
